{% extends "base.html" %}
{% block content %}
  <div class="category-selection">
    <div style="display: flex; align-items: center; justify-content: center; gap: 3rem;">
      <img id="icon-left" src="" alt="" style="width: 150px; height: auto; image-rendering: pixelated; image-rendering: -moz-crisp-edges; image-rendering: crisp-edges;" />
      <h2 class="category-title" style="text-align: center;">{{ content.title }}</h2>
      <img id="icon-right" src="" alt="" style="width: 150px; height: auto; image-rendering: pixelated; image-rendering: -moz-crisp-edges; image-rendering: crisp-edges;" />
    </div>
  </div>

  <script>
    // Icon animation configuration based on category
    const iconAnimations = {
      love: { folder: 'Love_Small_Pink_Loop', frames: 4 },
      guidance: { folder: 'Guidance_Small_Pink_Loop', frames: 18 },
      fortune: { folder: 'Fortune_Small_Pink_Loop', frames: 9 },
      surprise: { folder: 'Surprise_Small_Pink_Loop', frames: 12 }
    };

    const category = "{{ session.get('category', 'fortune') }}";
    const config = iconAnimations[category] || iconAnimations.fortune;
    const FPS = 6;
    
    let currentFrame = 0;
    const iconLeft = document.getElementById('icon-left');
    const iconRight = document.getElementById('icon-right');
    const frameDelay = 1000 / FPS;
    const displayDuration = 10000; // 10 seconds
    const startTime = Date.now();

    function padNumber(num) {
      return String(num).padStart(5, '0');
    }

    function updateFrame() {
      const framePath = `/static/images/UI Elements/IconLoops/${config.folder}_${padNumber(currentFrame)}.png`;
      iconLeft.src = framePath;
      iconRight.src = framePath;
      
      currentFrame++;
      
      // Loop animation
      if (currentFrame >= config.frames) {
        currentFrame = 0;
      }
      
      // Check if 10 seconds have elapsed
      const elapsedTime = Date.now() - startTime;
      if (elapsedTime < displayDuration) {
        setTimeout(updateFrame, frameDelay);
      } else {
        // Return to start page after 10 seconds
        window.location.href = "{{ url_for('index') }}";
      }
    }

    // Start animation
    updateFrame();

    // Play random audio when page loads
    const audioFiles = [
      "{{ url_for('static', filename='audio/result/cook_09A.wav') }}",
      "{{ url_for('static', filename='audio/result/cook_09B.wav') }}",
      "{{ url_for('static', filename='audio/result/cook_09C.wav') }}",
      "{{ url_for('static', filename='audio/result/cook_09D.wav') }}",
      "{{ url_for('static', filename='audio/result/cook_09E.wav') }}"
    ];
    
    const randomIndex = Math.floor(Math.random() * audioFiles.length);
    const selectedAudio = audioFiles[randomIndex];
    
    console.log('Playing random result audio:', selectedAudio);
    
    const resultAudio = new Audio(selectedAudio);
    resultAudio.volume = 1.0;
    
    resultAudio.play()
      .then(() => {
        console.log('Result audio playing successfully');
      })
      .catch(error => {
        console.error('Audio playback failed:', error);
      });
  </script>
{% endblock %}
